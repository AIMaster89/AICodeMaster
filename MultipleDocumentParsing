import json
import boto3
# import botocore.config
import base64
from base64 import b64decode

def lambda_handler(event, context):
    
    try:
        llmInput1=event['data']
        bytes1 = b64decode(llmInput1, validate=True)
        
        prompt="\n\nHuman:The task is to identify and extract only 'Net total' nothing else from the Input documents and return it\n\nAssistant:" 

        message = {
        
            "role": "user", 
            "content": [ 
                { 
                "text": prompt 
                }, 
                { 
                "document": { 
                    "name": "invoice1", 
                    "format": "pdf", 
                    "source": { 
                        "bytes": bytes1 
                    } 
                } 
                }, 
                { 
                "document": { 
                    "name": "invoice2", 
                    "format": "pdf", 
                    "source": { 
                        "bytes": bytes1 
                    } 
                } 
                }
            ] 
        } 
        messages = []
        messages.append(message)

        modelId = 'anthropic.claude-3-haiku-20240307-v1:0'
        accept = 'application/json'
        contentType = 'application/json'
        bedrock_runtime_client = boto3.client(
            'bedrock-runtime',
            aws_access_key_id='', 
            aws_secret_access_key='',
            region_name='ap-south-1')
        response = bedrock_runtime_client.converse(modelId=modelId,messages=messages)
        print(f"output", response['output'])
        return response['output']['message']['content'][0]['text']

    except Exception as ex:
        print("Error in the main method :",ex)
        return{
            'statusCode':400,
            'errorMessage':"Model Error"
        }
